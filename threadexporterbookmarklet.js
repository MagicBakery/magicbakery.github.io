javascript:(function(){const mVersion="20251103012800";const FEED_SEL='[data-testid="feed-container"]';const PANEL_ID='gemini-injection-div';const BASE_COLOR='#f0f8ff';function escapeHtml(str){return str?str.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):"";}let old=document.getElementById(PANEL_ID);if(old)old.remove();const feed=document.querySelector(FEED_SEL);if(!feed){console.error(`Thread Exporter: Target feed container not found: ${FEED_SEL}`);return;}const panel=document.createElement("div");panel.id=PANEL_ID;panel.style.cssText=`position:relative;max-height:100vh;overflow-y:auto;padding:10px;padding-top:50px;margin-bottom:1rem;background:${BASE_COLOR};border:1px solid #1e90ff;border-radius:8px;box-shadow:0 4px 6px rgba(0,0,0,0.1);font-family:Inter,sans-serif;transition:background-color 0.5s;`;const header=document.createElement("div");header.style.cssText="position:absolute;top:0;left:0;right:0;display:flex;justify-content:space-between;align-items:center;padding:6px 10px;background:rgba(255,255,255,.95);border-bottom:1px solid #1e90ff;border-radius:8px 8px 0 0;z-index:10;";const title=document.createElement("span");title.textContent="Thread Exporter "+mVersion;title.style.cssText="font-weight:bold;color:black;padding:4px;";const controls=document.createElement("div");controls.style.cssText="display:flex;gap:6px;align-items:center;";const btnAnalyze=document.createElement("button");btnAnalyze.style.cssText="background:none;border:none;cursor:pointer;padding:4px;display:flex;align-items:center;justify-content:center;border-radius:4px;transition:background-color 0.2s;color:#1e90ff;transform:scale(1);";btnAnalyze.innerHTML='<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.5 9a9 9 0 0 1 14.5-5.5L23 10M1 14l4.5 5.5A9 9 0 0 0 20.5 15"></path></svg>';btnAnalyze.title='Analyze/Refresh Content';const btnClose=document.createElement("button");btnClose.style.cssText="background:none;border:none;cursor:pointer;padding:4px;display:flex;align-items:center;justify-content:center;border-radius:4px;transition:background-color 0.2s;color:#f44336;transform:scale(1);";btnClose.innerHTML='<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>';btnClose.title='Close Panel';const content=document.createElement("div");content.style.cssText="padding-bottom: 5px;";controls.appendChild(btnAnalyze);controls.appendChild(btnClose);header.appendChild(title);header.appendChild(controls);panel.appendChild(header);panel.appendChild(content);feed.parentNode.insertBefore(panel,feed);function analyze(){panel.style.backgroundColor='#f0fff0';const threadRoot=document.querySelector('div[id^="feedItem"]');const replyBtn=document.querySelector('[data-testid="post-reply-button"]');let totalCount="N/A";if(replyBtn){let spans=replyBtn.querySelectorAll("span");if(spans.length){totalCount=spans[spans.length-1].textContent.trim().replace(/\D/g,"")||"N/A";}}let allParticipantLinks=[];if(threadRoot){threadRoot.querySelectorAll('a[href$="feed_author"],a[href$="feed_commenter"]').forEach(a=>{if(a.children.length===0)allParticipantLinks.push(a);});}const visibleCommenters=allParticipantLinks.filter(link=>link.href.endsWith("feed_commenter")).length;let authorListHtml='<div style="margin:0;margin-top:1rem;">';const baseUrl=location.href.split("?")[0];let displayIndex=0;allParticipantLinks.forEach(link=>{const authorName=link.textContent.trim();const isOp=link.href.endsWith("feed_author");const contentId=`c${displayIndex}`;let commentText="Comment text not found.";let url="#";if(isOp){let opContainer=threadRoot||document;let el=opContainer.querySelector('[data-testid="post-body"]');if(el)commentText=el.textContent.trim();url=baseUrl;}else{let box=link.closest('[id^="comment_"]');if(box){let body=box.querySelector('[data-testid="comment-detail-body"]');if(body)commentText=body.textContent.trim();let id=(box.id||"").split("_").pop();url=`${baseUrl}/?comment=${id}`;}}authorListHtml+=`\n\t\t<div style="font-size: 0.9em; padding: 2px 0; border-bottom: 1px dashed #ccc; line-height: 1.5;">\n\t\t\t[${displayIndex}] <a href="${url}" target="_blank" class="cex-author" data-cid="${contentId}" style="color: #007bff; text-decoration: none; cursor: pointer;">${authorName}</a>\n\t\t</div>`;authorListHtml+=`\n\t\t<div id="${contentId}" style="display:none;margin:5px 0 10px 15px;padding:10px;background:#fff;border:1px solid #ddd;border-radius:4px;white-space:pre-wrap;max-height:200px;overflow-y:auto;">${escapeHtml(commentText)}</div>\n\t\t`;displayIndex++;});authorListHtml+="</div>";let errorHtml='';if(!threadRoot){errorHtml='<p style="margin: 1rem 0 0.5rem 0; font-size: 1em; color: #f44336; font-weight: bold;">Error: First thread container (div[id^="feedItem"]) not found.</p>';}content.innerHTML=`\n\t\t${errorHtml}\n\t\t<p style="margin: 0; padding-bottom: 0.5rem;">Loaded <span style="font-weight: bold; color: #4CAF50;">${visibleCommenters}/${totalCount}</span>.</p>\n\t\t${authorListHtml}\n\t\t<p style="font-size: 0.8em; margin-top: 0.5rem;">Last Analyzed: ${(new Date()).toLocaleTimeString()}</p>\n\t\t<p style="font-size: 0.8em; border-top: 1px dashed #ccc; padding-top: 5px;">Please visit <a href="https://magicbakery.github.io/?id=P${mVersion}" target="_blank" style="color: #007bff; text-decoration: none;">Magic Bakery</a> for updates of this bookmarklet.</p>\n\t`;document.querySelectorAll(".cex-author").forEach(a=>{a.addEventListener("click",e=>{if(e.button!==0)return;e.preventDefault();let box=document.getElementById(a.dataset.cid);if(box)box.style.display=box.style.display==="none"?"block":"none";});a.addEventListener("contextmenu",e=>{});});setTimeout(()=>{panel.style.backgroundColor=BASE_COLOR;},500);}btnAnalyze.onclick=analyze;btnClose.onclick=()=>panel.remove();analyze();})();